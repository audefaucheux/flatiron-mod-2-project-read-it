<h1>Library</h1>

<h3>Find a book:</h3>
<%= form_tag("/search", method: "get") do %>
  <%= label_tag(:q, "") %>
  <%= text_field_tag(:q) %>
  <%= submit_tag("Search") %>
<% end %>

<% if @request %>
  <table>
    <tr>
      <th>Book Title</th>
      <th>Author</th>
      <th>Action</th>
    </tr>
      <% @request.each do |book| %>
        <tr>
          <td><%= title = book["volumeInfo"]["title"] %></td>
          <td><% if book["volumeInfo"]["authors"].present? %>
            <%=author = book["volumeInfo"]["authors"].first %>
          <% end %></td>

          <% if @current_user.books.include?(title) %>
            <td><%= link_to "Remove from reading list", "/remove_from_reading_list/#{book.id}",{method: "delete"} %></td>
          <% else %>
            <td><%= link_to "Add to reading list", new_book_from_api_path(book_hash: book) ,{method: "post"} %></td>
          <%end%>
        </tr>
      <%end%>
    </table>
<% else %>
  <table>
    <tr>
      <th>Book Title</th>
      <th>Action</th>
    </tr>
      <% @books.each do |book| %>
        <tr>
          <td><%= link_to book.title, book %></td>
          <% if @current_user.books.include?(book) %>
            <td><%= link_to "Remove from reading list", "/remove_from_reading_list/#{book.id}",{method: "delete"} %></td>
          <% else %>
            <td><%= link_to "Add to reading list", "/add_to_reading_list/#{book.id}",{method: "post"} %></td>
          <% end %>
        </tr>
      <% end %>
      </tr>
  </table>
<% end %>